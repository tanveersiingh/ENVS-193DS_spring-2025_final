---
title: "final"
format: html
editor: visual
---

# Github link

[Github Repository](https://github.com/tanveersiingh/ENVS-193DS_spring-2025_final.git)

# Set up

```{r}
# load packages
library(tidyverse) # general use
library(here) # file organization
library(flextable) # creating tables
library(janitor) # cleaning data frames
library(officer) # table formatting
library(dplyr)
library(lubridate)
library(DHARMa)
library(MuMIn)
# read in data
sst <- read_csv("./data/SST_update2023.csv")
nest_boxes <- read_csv("./data/occdist.csv")
```

# Problem 1. Research writing

## a. Transparent statistical methods

In part 1, they used a Pearson correlation test.In part 2, they used a one way ANOVA test.

## b. More information needed

The one-way ANOVA shows that at least one source differs in average nitrogen load, but not which one(s). I recommend adding a Tukey's HSD post hoc test to determine which specific source pairs differ significantly. Additionally, although p = 0.02 indicates statistical significance, it does not show the magnitude of those differences. To address this, I suggest calculating Cohen’s d to quantify the effect size between each pair of sources, indicating whether differences are small, medium, or large.

## c. Suggestions for rewriting

Biological narrative: Average nitrogen load (kg year$^{-1}$) differs among sources, with urban land contributing notably higher nitrogen levels compared to grasslands, suggesting source-specific impacts on nitrogen pollution. Statistical summary: We rejected the null hypothesis that there is no difference in average nitrogen load (kg year$^{-1}$) among sources (urban land, atmospheric deposition, fertilizer, wastewater treatment, and grasslands). We found a small/medium/large effect size ($\eta^2$ = effect size) using a one-way ANOVA (F(df$_1$, df$_2$) = F-statistic, p = 0.02, $\alpha$ = significance level). On average, Source A has a higher/lower nitrogen load than Source B (difference between groups, 95% CI: \[lower, upper\] kg year$^{-1}$).

# Problem 2. Data visualization

## a. Cleaning and summarizing

```{r}
sst_clean <- sst |> # start with df
  mutate( # use mutate the create year and month from date
    year = year(date), # create year column
    month = month(date, label = TRUE, abbr = TRUE) # create month column with the abbreviations 
  ) |>
  filter(year >= 2018 & year <= 2023) |> # selecting only years 2018 - 2023
  mutate(year = as.factor(year)) |> # change year column to factor
  group_by(year, month) |> # grouping year and month for summary calculations
  summarize(mean_monthly_sst = round(mean(temp, na.rm = TRUE), 1)) # summarize and round mean_monthly_sst

print(slice_sample(sst_clean, n = 5)) # slice and print 5 random rows
print(str(sst_clean)) # print the structure of sst_clean
```

## b. Visualize the data

```{r}
ggplot(sst_clean,
       aes(x = month,
           y = mean_monthly_sst,
           color = year,
           group = year)) +
  geom_point() +
  geom_line() +
  scale_color_manual(
    values = c(
      "2018" = "mistyrose",
      "2019" = "lightcoral",
      "2020" = "indianred",
      "2021" = "firebrick",
      "2022" = "red",
      "2023" = "darkred")) +
  ylim(NA, 20) +
  labs(
    x = "Month",
    y = "Mean monthly sea surface temperature (°C)",
    color = "Year") +
  theme_bw() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    legend.position = c(0.10, 0.70))
```


# Problem 3. Data analysis

```{r}
nest_boxes_clean <- clean_names(nest_boxes) |>
  dplyr::select(box_occupant, season, edge_distance, sp, cs, e, tm)
```


## a. Response variable

In this experiment, nest box occupancy was recorded as a binary variable: 1 indicated a nest box was occupied by the species, and 0 indicated it was unoccupied.


## b. Purpose of study

The main difference is that Swift Parrots are the target species for the study and only use the nest boxes during the breeding season. Common Starlings and Tree Martins are non target competitors who more consistently occupy the nest boxes over time.

## c. Difference in “seasons”

The two "seasons" compared are in 2016 (when the nest boxes were deployed) and 2019 (after three years of deployment of nest boxes).

## d. Table of models

| Model number | box occupancy | season | distance to forest edge | model description                 |      
|:------------:|:---:|:---------------::-------:  |-----------------------------      |  
| 0            |     |                            | null model                        |
| 1            |  X  |             X              | a saturated model.                |
| 2            |  X  |                            | Season only model                 |
| 3            |     |             X              | Distance to forest edge only model|


## e. Run the models

model0 <- glm(
  sp ~ 1, # formula
  data = nest_boxes_clean, # data frame
  family = "binomial"
)

model1 <- glm(
  sp ~ season + edge_distance, # formula
  data = nest_boxes_clean, # data frame
  family = "binomial"
)

model2 <- glm(
  sp ~ season, # formula
  data = nest_boxes_clean, # data frame
  family = "binomial"
)

model3 <- glm(
  sp ~ edge_distance, # formula
  data = nest_boxes_clean, # data frame
  family = "binomial"
)

## f. Check the diagnostics

par(mfrow = c(2,2))
plot(model0)
plot(model1) # residuals look ok
plot(model2)
plot(model3)

## g. Select the best model

AICc(model1, # best model
     model2,
     model3) |>
     arrange(AICc)

